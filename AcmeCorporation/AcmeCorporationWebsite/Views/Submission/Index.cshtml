@{
    ViewData["Title"] = "Index";
}

<h1>Enter draw for a price</h1>

<p>
    To enter the draw for a chance to win a free trip to the Bahamas, simply fill out the form and submit it by the deadline.<br />
    You have to a valid serial number from purchasing one of Acme Corporation’s products and you must be at least 18 years old.<br />
    A valid serial number can be used twice.Use this page to detail your site's privacy policy.
</p>


<div class="container p-3">
    <div class="row pt-4">
        <div class="col-6">
            <h2 class="text-primary">Submission List</h2>
        </div>
        <div class="col-6 text-end">
            <a asp-controller="Submission" asp-action="SubmitForm" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> &nbsp; Submit a new form
            </a>
        </div>
    </div>

    <div id="submission-list">
        <table class="table table-borered table-striped" style="width:100%">
            <thead>
                <tr class="table-primary">
                    <th>
                        Name
                    </th>
                    <th>
                        Email
                    </th>
                    <th>
                        Product Serial Number
                    </th>
                    <th>
                        Created date
                    </th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div>
    <ul class="pagination" id="pagination">
    </ul>
</div>


@section Scripts {
    <script>
        function loadSubmissions(page, pageSize) {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSubmissions", "Submission")',
                data: { page: page, pageSize: pageSize },
                success: function (result) {
                    renderSubmissions(result.submissions);
                    renderPagination(page, pageSize, result.totalCount);
                },
                error: function (error) {
                    console.error('Error fetching submissions: ' + error);
                }
            });
        }

        function renderSubmissions(submissions) {
            var submissionList = $('#submission-list tbody');
            submissionList.empty();
            submissions.forEach(submission => {
                var row = `<tr class="table-light">
                                <td width="25%">${submission.firstName} ${submission.lastName}</td>
                                <td width="25%">${submission.email}</td>
                                <td width="25%">${submission.productSerialNumber}</td>
                                <td width="25%">${submission.createdDateTime}</td>
                           </tr>`;
                submissionList.append(row);
            });
        }
        function renderPagination(page, pageSize, totalCount) {
            var totalPages = Math.ceil(totalCount / pageSize);
            var pagination = $('#pagination');
            pagination.empty();
            for (var i = 1; i <= totalPages; i++) {
                if (i === page) {
                    pagination.append(`<li class="page-item active"><a class="page-link" href="#">${i}</a></li>`);
                } else {
                    pagination.append(`<li class="page-item"><a class="page-link" href="#" onclick="loadSubmissions(${i}, ${pageSize})">${i}</a></li>`);
                }
            }
        }

        // Load initial submissions on page load
        $(document).ready(function () {
            loadSubmissions(1, 10);
        });
    </script>
}